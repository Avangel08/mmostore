import{X as G,d as P,A as _,j as e,R as L}from"./ContextMenuProvider-DoI9LuTu.js";import{u as O,c as V,a as h}from"./index.esm-yjK6ua4W.js";import{s as n}from"./showToast-BFjkHmvN.js";import{u as $}from"./useTranslation-Bh5zzBC_.js";import{F as o}from"./Form-C6Oq7frR.js";import{A as z}from"./Alert-DmeDZGUk.js";import{R as H}from"./Row-DaX0pFtU.js";import{C as M}from"./Col-BERnSmBs.js";import{B as R}from"./Button-CdshqBqI.js";import"./isSymbol-CYvIzdD2.js";import"./hoist-non-react-statics.cjs-BsRiVy2U.js";import"./react-toastify.esm-8BWsAHON.js";import"./ThemeProvider-CQKb4rSK.js";import"./index-B7rcZTdA.js";import"./hook-Crll79d-.js";import"./extends-CF3RwP-h.js";import"./objectWithoutPropertiesLoose-Dsqj8S3w.js";import"./useEventCallback-BA23UYAQ.js";import"./divWithClassName-Ct-4CK0x.js";import"./Anchor-B8rOyTnZ.js";import"./useEventCallback-Bsoi2xyD.js";import"./Button-lElTeqs9.js";import"./Fade-iG7JUvQW.js";import"./TransitionWrapper-CRtjL7Sb.js";import"./useMergedRefs-Cm3LQ1VB.js";import"./setPrototypeOf-DgZC2w_0.js";import"./CloseButton-feMrj_cP.js";const je=({activeTab:q})=>{var x,f,I,j,b,v,N,D,y,C,T,w,F,S,k,E;const{t:s}=$();G().props.errors;const{settings:t}=G().props,[g,u]=P.useState(!1),r=O({enableReinitialize:!0,initialValues:{enabled:((x=t==null?void 0:t.notification)==null?void 0:x.enabled)||!1,groupId:((f=t==null?void 0:t.notification)==null?void 0:f.groupId)||"",topicId:((I=t==null?void 0:t.notification)==null?void 0:I.topicId)||"",message:((j=t==null?void 0:t.notification)==null?void 0:j.message)||`{paid_time}
                Order ID: {order_id}
                Tổng tiền: {amount}
                Số lượng: {quantity}
                Sản phẩm: {product_name}`},validationSchema:V({groupId:h().when("enabled",{is:!0,then:a=>a.required(s("Please enter group ID")),otherwise:a=>a}),topicId:h().when("enabled",{is:!0,then:a=>a.required(s("Please enter topic ID")),otherwise:a=>a}),message:h().when("enabled",{is:!0,then:a=>a.required(s("Please enter message")),otherwise:a=>a})}),onSubmit:a=>{const d=new FormData;d.append("notification[enabled]",a.enabled.toString()),d.append("notification[groupId]",a.groupId),d.append("notification[topicId]",a.topicId),d.append("notification[message]",a.message),d.append("tab",q);const l=route("seller.theme-settings.update",{id:t.id});_.post(l,d,{preserveScroll:!0,onSuccess:i=>{var c,p,m,B;if((p=(c=i.props)==null?void 0:c.message)!=null&&p.error){n(s(i.props.message.error),"error");return}(B=(m=i.props)==null?void 0:m.message)!=null&&B.success?(n(s(i.props.message.success),"success"),r.resetForm()):n(s("Settings updated successfully"),"success")},onError:i=>{Object.keys(i).forEach(c=>{n(s(i[c]),"error")})}})}}),A=async()=>{if(!r.values.groupId||!r.values.topicId){n(s("Please enter group ID and topic ID first"),"error");return}u(!0);try{const a=new FormData;a.append("groupId",r.values.groupId),a.append("topicId",r.values.topicId),a.append("message",r.values.message),a.append("test","true");const d=route("seller.theme-settings.test-telegram");_.post(d,a,{preserveScroll:!0,onSuccess:l=>{var i,c,p,m;(c=(i=l.props)==null?void 0:i.message)!=null&&c.error?n(s(l.props.message.error),"error"):(m=(p=l.props)==null?void 0:p.message)!=null&&m.success?n(s(l.props.message.success),"success"):n(s("Test notification sent successfully"),"success")},onError:l=>{Object.keys(l).forEach(i=>{n(s(l[i]),"error")})},onFinish:()=>{u(!1)}})}catch{n(s("Error sending test notification"),"error"),u(!1)}};return e.jsx(L.Fragment,{children:e.jsxs(o,{noValidate:!0,onSubmit:r.handleSubmit,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(z,{variant:"info",className:"mb-4",children:e.jsx("div",{className:"d-flex align-items-start",children:e.jsxs("div",{children:[e.jsx("h6",{className:"alert-heading",children:s("How to setup Telegram notifications")}),e.jsxs("ol",{className:"mb-0",children:[e.jsx("li",{children:s("Create a Telegram group and add bot @mmoshopio_bot to the group")}),e.jsx("li",{children:s("Get the group ID (usually starts with -)")}),e.jsx("li",{children:s("Create a topic in the group and get the topic ID")}),e.jsx("li",{children:s("Enter the group ID and topic ID below")})]})]})})}),e.jsx(H,{children:e.jsxs(M,{children:[e.jsx("div",{className:"mb-4",children:e.jsx(o.Group,{children:e.jsx(o.Check,{type:"switch",id:"enabled",label:s("Enable Telegram notifications"),checked:r.values.enabled,onChange:a=>{r.setFieldValue("enabled",a.target.checked)}})})}),r.values.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs(o.Group,{children:[e.jsxs(o.Label,{className:"form-label",htmlFor:"groupId",children:[s("Group ID")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(o.Control,{type:"text",className:"form-control",onChange:r.handleChange,onBlur:r.handleBlur,name:"groupId",id:"groupId",placeholder:s("Enter your group ID"),value:r.values.groupId,isInvalid:!!((b=r.touched)!=null&&b.groupId&&((v=r.errors)!=null&&v.groupId))}),e.jsx(o.Text,{className:"text-muted",children:s("Group ID usually starts with - (e.g., -1001234567890)")})]}),((N=r.touched)==null?void 0:N.groupId)&&((D=r.errors)==null?void 0:D.groupId)&&e.jsx("div",{className:"invalid-feedback d-block",children:s(r.errors.groupId)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs(o.Group,{children:[e.jsxs(o.Label,{className:"form-label",htmlFor:"topicId",children:[s("Topic ID")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(o.Control,{type:"text",className:"form-control",onChange:r.handleChange,onBlur:r.handleBlur,name:"topicId",id:"topicId",placeholder:s("Enter your topic ID"),value:r.values.topicId,isInvalid:!!((y=r.touched)!=null&&y.topicId&&((C=r.errors)!=null&&C.topicId))}),e.jsx(o.Text,{className:"text-muted",children:s("Topic ID is a number after Group ID (e.g., 123)")})]}),((T=r.touched)==null?void 0:T.topicId)&&((w=r.errors)==null?void 0:w.topicId)&&e.jsx("div",{className:"invalid-feedback d-block",children:s(r.errors.topicId)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs(o.Group,{children:[e.jsxs(o.Label,{className:"form-label",htmlFor:"message",children:[s("Message")," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(o.Control,{as:"textarea",rows:8,className:"form-control",onChange:r.handleChange,onBlur:r.handleBlur,name:"message",id:"message",placeholder:s("Enter your message"),value:r.values.message,isInvalid:!!((F=r.touched)!=null&&F.message&&((S=r.errors)!=null&&S.message))}),e.jsx(o.Text,{className:"text-muted",children:s("Available : {paid_time}, {order_id}, {amount}, {quantity}, {product_name}")})]}),((k=r.touched)==null?void 0:k.message)&&((E=r.errors)==null?void 0:E.message)&&e.jsx("div",{className:"invalid-feedback d-block",children:s(r.errors.message)})]}),e.jsx("div",{className:"mb-4",children:e.jsx(R,{variant:"outline-primary",onClick:A,disabled:g||!r.values.groupId||!r.values.topicId,children:g?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),s("Send Test Notification")]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-send-plane-line me-2"}),s("Send Test Notification")]})})})]})]})})]}),e.jsx("div",{className:"text-start",children:e.jsx(R,{type:"submit",variant:"success",children:s("Update")})})]})})};export{je as default};
