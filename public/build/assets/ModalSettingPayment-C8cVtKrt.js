import{X as U,d as b,A as C,j as s}from"./ContextMenuProvider-DoI9LuTu.js";import{c as X,a as x,u as z}from"./index.esm-yjK6ua4W.js";import{s as p}from"./showToast-BFjkHmvN.js";import{u as H}from"./useTranslation-Bh5zzBC_.js";import{M as k}from"./Modal-Ct9dsq7D.js";import{F as u}from"./Form-C6Oq7frR.js";import{B as j}from"./Button-CdshqBqI.js";import"./isSymbol-CYvIzdD2.js";import"./hoist-non-react-statics.cjs-BsRiVy2U.js";import"./react-toastify.esm-8BWsAHON.js";import"./ThemeProvider-CQKb4rSK.js";import"./useMergedRefs-Cm3LQ1VB.js";import"./useEventCallback-BA23UYAQ.js";import"./useWillUnmount-CWisbIWq.js";import"./TransitionWrapper-CRtjL7Sb.js";import"./objectWithoutPropertiesLoose-Dsqj8S3w.js";import"./setPrototypeOf-DgZC2w_0.js";import"./AbstractModalHeader-Baf6fi1-.js";import"./useWindow-B3mPSubg.js";import"./querySelectorAll-rMMgkU1T.js";import"./useEventCallback-Bsoi2xyD.js";import"./hasClass-B9uJik72.js";import"./NoopTransition-Badst7zB.js";import"./DataKey-DjdvojM5.js";import"./CloseButton-feMrj_cP.js";import"./index-B7rcZTdA.js";import"./Fade-iG7JUvQW.js";import"./divWithClassName-Ct-4CK0x.js";import"./Col-BERnSmBs.js";import"./Button-lElTeqs9.js";const Be=({show:N,onHide:S,dataEdit:r,dataOptions:c})=>{var F,I,T,A,V,q,G,M;const{t:n}=H(),l=U().props.errors,[R,_]=b.useState(!1),[W,f]=b.useState(!1),[B,w]=b.useState(!1),[$,v]=b.useState(!1),[D,P]=b.useState(!1),L=!!r,Y=b.useMemo(()=>X({type:x().required(n("Please select a type")),key:x().required(n("Please select a bank")),account_name:x().max(150,"Must be 150 characters or less").required(n("Please enter this field")),account_number:x().required(n("Please enter this field")),user_name:x().when("type",{is:o=>{var m;return((m=c==null?void 0:c.listTypeOptions)==null?void 0:m[o])==="BANK"},then:o=>o.required(n("Please enter this field")),otherwise:o=>o.notRequired()}),password:x().when("type",{is:o=>{var m;return((m=c==null?void 0:c.listTypeOptions)==null?void 0:m[o])==="BANK"},then:o=>o.required(n("Please enter this field")),otherwise:o=>o.notRequired()}),...B?{otp:x().required(n("Please enter this field"))}:{},api_key:x().when("type",{is:o=>{var m;return((m=c==null?void 0:c.listTypeOptions)==null?void 0:m[o])==="SEPAY"},then:o=>o.required(n("Please enter this field")),otherwise:o=>o.notRequired()})}),[B,n,c]),e=z({initialValues:{id:(r==null?void 0:r.id)||"",type:(r==null?void 0:r.type)||"BANK",key:(r==null?void 0:r.key)||"",account_name:((F=r==null?void 0:r.details)==null?void 0:F.account_name)||"",account_number:((I=r==null?void 0:r.details)==null?void 0:I.account_number)??"",user_name:((T=r==null?void 0:r.details)==null?void 0:T.user_name)??"",password:((A=r==null?void 0:r.details)==null?void 0:A.password)??"",otp:"",api_key:((V=r==null?void 0:r.details)==null?void 0:V.api_key)??""},validationSchema:Y,onSubmit:o=>{const m=L?route("admin.payment-method.update",{id:r.id}):route("admin.payment-method.store");C[L?"put":"post"](m,o,{onSuccess:t=>{var h,i,y,g;if((i=(h=t.props)==null?void 0:h.message)!=null&&i.error){p(n(t.props.message.error),"error");return}e.resetForm(),S(),(g=(y=t.props)==null?void 0:y.message)!=null&&g.success&&p(n(t.props.message.success),"success")}})}});return b.useEffect(()=>{var o,m,a,t,h;N?(e.setValues({id:(r==null?void 0:r.id)||"",type:r!=null&&r.type?String(r==null?void 0:r.type):"0",key:(r==null?void 0:r.key)||"",account_name:((o=r==null?void 0:r.details)==null?void 0:o.account_name)||"",account_number:((m=r==null?void 0:r.details)==null?void 0:m.account_number)??"",user_name:((a=r==null?void 0:r.details)==null?void 0:a.user_name)??"",password:((t=r==null?void 0:r.details)==null?void 0:t.password)??"",otp:"",api_key:((h=r==null?void 0:r.details)==null?void 0:h.api_key)??""}),w(!1),v(!1),_(!1),f(!1),P(!1)):e.resetForm()},[N,r]),s.jsx(k,{id:"myModal",backdrop:"static",show:N,onHide:()=>{e.resetForm(),S()},centered:!0,children:s.jsxs(u,{onSubmit:e.handleSubmit,noValidate:!0,children:[s.jsx(k.Header,{closeButton:!0,children:s.jsx("h5",{children:n("Setting Payment")})}),s.jsxs(k.Body,{children:[s.jsxs(u.Group,{className:"mb-3",controlId:"name",children:[s.jsxs(u.Label,{children:[n("Type")," ",s.jsx("span",{className:"text-danger",children:"*"})]}),s.jsxs(u.Select,{name:"type",onChange:e.handleChange,onBlur:e.handleBlur,value:e.values.type,isInvalid:!!(e.touched.type&&e.errors.type||l!=null&&l.type),children:[s.jsx("option",{value:"",children:n("Select type")}),(c==null?void 0:c.listTypeOptions)&&Object.keys(c.listTypeOptions).map(o=>s.jsx("option",{value:o,selected:e.values.type===o,children:n(c.listTypeOptions[o])},o))]}),s.jsx(u.Control.Feedback,{type:"invalid",children:n(e.errors.type||(l==null?void 0:l.type))})]}),s.jsxs(u.Group,{className:"mb-3",controlId:"key",children:[s.jsxs(u.Label,{children:[n("Bank")," ",s.jsx("span",{className:"text-danger",children:"*"})]}),s.jsxs(u.Select,{name:"key",onChange:e.handleChange,onBlur:e.handleBlur,value:e.values.key,isInvalid:!!(e.touched.key&&e.errors.key||l!=null&&l.key),children:[s.jsx("option",{value:"",children:n("Select bank")}),((q=c==null?void 0:c.listTypeOptions)==null?void 0:q[e.values.type])==="BANK"?(c==null?void 0:c.listBank)&&Object.keys(c.listBank).map(o=>s.jsx("option",{value:o,selected:e.values.key===o,children:n(c.listBank[o])},o)):(c==null?void 0:c.listBankSePay)&&Object.keys(c.listBankSePay).map(o=>s.jsx("option",{value:c.listBankSePay[o].code,selected:e.values.key===c.listBankSePay[o].code,children:n(c.listBankSePay[o].short_name)},o))]}),s.jsx(u.Control.Feedback,{type:"invalid",children:n(e.errors.key||(l==null?void 0:l.key))})]}),s.jsxs(u.Group,{className:"mb-3",controlId:"categoryName",children:[s.jsxs(u.Label,{children:[n("Account name"),s.jsx("span",{className:"text-danger",children:"*"})]}),s.jsx(u.Control,{name:"account_name",type:"text",placeholder:n("Enter account name"),maxLength:150,onChange:e.handleChange,onBlur:e.handleBlur,value:e.values.account_name,isInvalid:!!(e.touched.account_name&&e.errors.account_name||l!=null&&l.account_name)}),s.jsx(u.Control.Feedback,{type:"invalid",children:n(e.errors.account_name||(l==null?void 0:l.account_name))})]}),s.jsxs(u.Group,{className:"mb-3",controlId:"categoryName",children:[s.jsxs(u.Label,{children:[n("Account number"),s.jsx("span",{className:"text-danger",children:"*"})]}),s.jsx(u.Control,{name:"account_number",type:"text",placeholder:n("Enter account number"),maxLength:150,onChange:e.handleChange,onBlur:e.handleBlur,value:e.values.account_number,isInvalid:!!(e.touched.account_number&&e.errors.account_number||l!=null&&l.account_number)}),s.jsx(u.Control.Feedback,{type:"invalid",children:n(e.errors.account_number||(l==null?void 0:l.account_number))})]}),((G=c==null?void 0:c.listTypeOptions)==null?void 0:G[e.values.type])==="BANK"&&s.jsxs(s.Fragment,{children:[s.jsxs(u.Group,{className:"mb-3",controlId:"categoryName",children:[s.jsxs(u.Label,{children:[n("User name"),s.jsx("span",{className:"text-danger",children:"*"})]}),s.jsx(u.Control,{name:"user_name",type:"text",placeholder:n("0974 xxx xxx"),maxLength:150,onChange:e.handleChange,onBlur:e.handleBlur,value:e.values.user_name,isInvalid:!!(e.touched.user_name&&e.errors.user_name||l!=null&&l.user_name)}),s.jsx(u.Control.Feedback,{type:"invalid",children:n(e.errors.user_name||(l==null?void 0:l.user_name))})]}),s.jsxs(u.Group,{className:"mb-3",controlId:"categoryName",children:[s.jsxs(u.Label,{children:[n("Password"),s.jsx("span",{className:"text-danger",children:"*"})]}),s.jsx(u.Control,{name:"password",type:"text",placeholder:n("Enter password"),maxLength:150,onChange:e.handleChange,onBlur:e.handleBlur,value:e.values.password,isInvalid:!!(e.touched.password&&e.errors.password||l!=null&&l.password)}),s.jsx(u.Control.Feedback,{type:"invalid",children:n(e.errors.password||(l==null?void 0:l.password))})]}),s.jsx(j,{variant:"success",type:"button",className:"mb-3",disabled:R,onClick:async o=>{o.preventDefault(),o.stopPropagation(),_(!0),e.setTouched({key:!0,account_name:!0,account_number:!0,user_name:!0,password:!0,otp:e.touched.otp||!1});const m=await e.validateForm();if(m.key||m.account_name||m.account_number||m.user_name||m.password){p(n("Please enter this field"),"error"),_(!1);return}C.post(route("admin.payment-method.verify-payment"),{key:e.values.key,account_name:e.values.account_name,account_number:e.values.account_number,user_name:e.values.user_name,password:e.values.password,otp:e.values.otp??null},{preserveScroll:!0,preserveState:!0,only:[],onSuccess:a=>{var t,h,i,y,g,K;if((h=(t=a.props)==null?void 0:t.message)!=null&&h.error){p(n(a.props.message.error),"error"),v(!1),_(!1);return}if((y=(i=a.props)==null?void 0:i.message)!=null&&y.info){p(n(a.props.message.info),"success"),w(!0),v(!0),_(!1);return}p(n(((K=(g=a.props)==null?void 0:g.message)==null?void 0:K.success)||"Verified successfully"),"success"),v(!0),_(!1)},onError:()=>{p(n("Verification failed"),"error"),_(!1)},onFinish:()=>{}})},children:n("Verify Payment")}),B&&s.jsxs(u.Group,{className:"mb-3",children:[s.jsxs(u.Label,{children:[n("OTP"),s.jsx("span",{className:"text-danger",children:"*"})]}),s.jsx(u.Control,{name:"otp",type:"text",placeholder:n("Enter OTP"),maxLength:150,onChange:e.handleChange,onBlur:e.handleBlur,value:e.values.otp,isInvalid:!!(e.touched.otp&&e.errors.otp||l!=null&&l.otp)}),s.jsx(u.Control.Feedback,{type:"invalid",children:n(e.errors.otp||(l==null?void 0:l.otp))})]})]}),((M=c==null?void 0:c.listTypeOptions)==null?void 0:M[e.values.type])==="SEPAY"&&s.jsxs(s.Fragment,{children:[s.jsxs(u.Group,{className:"mb-3",children:[s.jsxs(u.Label,{children:[n("Api Key"),s.jsx("span",{className:"text-danger",children:"*"})]}),s.jsx(u.Control,{name:"api_key",type:"text",placeholder:n("Enter API key"),maxLength:150,onChange:e.handleChange,onBlur:e.handleBlur,value:e.values.api_key,isInvalid:!!(e.touched.api_key&&e.errors.api_key||l!=null&&l.api_key)}),s.jsx(u.Control.Feedback,{type:"invalid",children:n(e.errors.api_key||(l==null?void 0:l.api_key))})]}),s.jsx(j,{variant:"success",type:"button",className:"mb-3",disabled:W,onClick:async o=>{o.preventDefault(),o.stopPropagation(),f(!0),e.setTouched({key:!0,account_name:!0,account_number:!0,user_name:!1,password:!1,otp:e.touched.otp||!1,api_key:!0});const m=await e.validateForm();if(m.key||m.account_name||m.account_number||m.api_key){p(n("Please enter this field"),"error"),f(!1);return}C.post(route("admin.payment-method.verify-sepay"),{key:e.values.key,account_name:e.values.account_name,account_number:e.values.account_number,api_key:e.values.api_key},{preserveScroll:!0,preserveState:!0,only:[],onSuccess:a=>{var t,h,i,y;if((h=(t=a.props)==null?void 0:t.message)!=null&&h.error){p(n(a.props.message.error),"error"),v(!1),f(!1);return}p(n(((y=(i=a.props)==null?void 0:i.message)==null?void 0:y.success)||"Verified successfully"),"success"),P(!0),v(!0),f(!1)},onError:()=>{p(n("Verification failed"),"error"),f(!1)},onFinish:()=>{}})},children:n("Verify Payment")}),D&&s.jsxs(u.Group,{className:"mb-3",children:[s.jsxs(u.Label,{children:[n("Link Webhook"),s.jsx("span",{className:"text-danger",children:"*"})]}),s.jsx(u.Control,{value:c==null?void 0:c.linkWebhook,readOnly:!0})]})]})]}),s.jsxs(k.Footer,{children:[s.jsx(j,{variant:"light",onClick:()=>{e.resetForm(),S()},children:n("Close")}),s.jsx(j,{variant:"primary",type:"submit",disabled:!$,children:n("Save changes")})]})]})})};export{Be as ModalSettingPayment};
