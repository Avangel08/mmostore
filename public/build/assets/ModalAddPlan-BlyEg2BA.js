import{X as k,d as u,A as P,j as e,e as H}from"./ContextMenuProvider-DoI9LuTu.js";import{u as D,c as ee,a as j,d as se}from"./index.esm-yjK6ua4W.js";import{A as G}from"./index-C98xhMJs.js";import{N as te}from"./react-number-format.es-CUqECRIb.js";import{s as re}from"./showToast-BFjkHmvN.js";import{a as ne}from"./sweetAlert-NpllgYUb.js";import{F as ie,_ as de,v as oe}from"./default-DKET8U34.js";import{h as l}from"./moment-C5S46NFB.js";import{u as le}from"./useTranslation-Bh5zzBC_.js";import{M as g}from"./Modal-Ct9dsq7D.js";import{F as d}from"./Form-C6Oq7frR.js";import{R as p}from"./Row-DaX0pFtU.js";import{C as m}from"./Col-BERnSmBs.js";import{B as O}from"./Button-CdshqBqI.js";import"./isSymbol-CYvIzdD2.js";import"./hoist-non-react-statics.cjs-BsRiVy2U.js";import"./react-select.esm-Ci0lS3LH.js";import"./objectWithoutPropertiesLoose-Dsqj8S3w.js";import"./extends-CF3RwP-h.js";import"./setPrototypeOf-DgZC2w_0.js";import"./inherits-B2gPeQio.js";import"./react-toastify.esm-8BWsAHON.js";import"./sweetalert2.esm.all-5zhdP7Ax.js";import"./index-B7rcZTdA.js";import"./ThemeProvider-CQKb4rSK.js";import"./useMergedRefs-Cm3LQ1VB.js";import"./useEventCallback-BA23UYAQ.js";import"./useWillUnmount-CWisbIWq.js";import"./TransitionWrapper-CRtjL7Sb.js";import"./AbstractModalHeader-Baf6fi1-.js";import"./useWindow-B3mPSubg.js";import"./querySelectorAll-rMMgkU1T.js";import"./useEventCallback-Bsoi2xyD.js";import"./hasClass-B9uJik72.js";import"./NoopTransition-Badst7zB.js";import"./DataKey-DjdvojM5.js";import"./CloseButton-feMrj_cP.js";import"./Fade-iG7JUvQW.js";import"./divWithClassName-Ct-4CK0x.js";import"./Button-lElTeqs9.js";const We=({show:f,onHide:v,userDataPlan:r})=>{var I,M,E,S,F,C,w,$,A,Y,T,V,B,L;const{t,i18n:q}=le(),{errors:_,storageUrl:z}=k().props,R=u.useRef(null),[U,b]=u.useState(null),[X,N]=u.useState(null),J=()=>{switch(q.language){case"vi":return oe.Vietnamese;default:return de.english}},y=999999999,s=D({initialValues:{userId:(r==null?void 0:r.id)??"",planId:"",datetimeExpired:"",paymentMethodId:"",amount:"",note:""},validationSchema:ee({planId:j().required(t("Please select plan")),datetimeExpired:j().required(t("Please select time")).test("is-after-now",t("Expiration time must be after current time"),function(n){return n?l(n).isAfter(l()):!1}),paymentMethodId:j().required(t("Please select payment method")),amount:se().min(0,t("Amount must be greater than or equal to 0")).max(y,`Amount must be less than ${y}`).required(t("Please enter amount")),note:j().max(1e4,t("Maximum {{count}} characters",{count:1e4}))}),onSubmit:async n=>{if(!await ne({title:t("Are you sure?"),text:t("Do you want to add this plan for the user?"),icon:"question",confirmButtonText:t("Yes, add plan"),cancelButtonText:t("Cancel")}))return;const a=route("admin.user.add-plan");P.post(a,n,{replace:!0,preserveScroll:!0,preserveState:!0,onSuccess:o=>{var i,h;(h=(i=o.props)==null?void 0:i.message)!=null&&h.error||(s.resetForm(),v())},onError:o=>{Object.keys(o).forEach(i=>{re(t(o[i]),"error")})}})}}),K=async(n,c,{page:a})=>{var o;try{const i=await H.get(route("admin.payment-method.list-method",{search:n,page:a,includeAll:!1}));return{options:((o=i==null?void 0:i.data)==null?void 0:o.results)??[],hasMore:i.data.has_more,additional:{page:a+1}}}catch{return{options:[],hasMore:!1}}},Q=n=>{if(b(n),s.setFieldValue("planId",(n==null?void 0:n.value)??""),n&&(s.setFieldValue("amount",n.price??""),n.interval)){const c=l().add(n.interval,"days");s.setFieldValue("datetimeExpired",c.format("YYYY-MM-DD HH:mm"))}},W=n=>{N(n),s.setFieldValue("paymentMethodId",(n==null?void 0:n.value)??"")},Z=async(n,c,{page:a})=>{var o;try{const i=await H.get(route("admin.plans.list-plan",{search:n,page:a}));return{options:((o=i==null?void 0:i.data)==null?void 0:o.results)??[],hasMore:i.data.has_more,additional:{page:a+1}}}catch{return{options:[],hasMore:!1}}};return u.useEffect(()=>{s.setErrors(_||{})},[_]),u.useEffect(()=>{f?(b(null),N(null),s.setValues({userId:(r==null?void 0:r.id)??"",planId:"",datetimeExpired:"",paymentMethodId:"",amount:"",note:""}),s.setTouched({}),s.setErrors({})):(s.resetForm(),b(null),N(null))},[f,r]),e.jsxs(g,{id:"modalAddPlan",backdrop:"static",show:f,onHide:()=>{s.resetForm(),v()},centered:!0,size:"lg",scrollable:!0,enforceFocus:!1,children:[e.jsx(g.Header,{closeButton:!0,children:e.jsx("h5",{children:t("Add plan for user")})}),e.jsx(g.Body,{className:"p-4",children:e.jsxs(d,{onSubmit:s.handleSubmit,noValidate:!0,children:[e.jsx(p,{className:"mb-4",children:e.jsx(m,{md:12,children:e.jsxs(d.Group,{controlId:"userInfo",children:[e.jsx(d.Label,{className:"fw-semibold",children:t("User information")}),e.jsx("div",{className:"p-3 bg-light rounded",children:e.jsxs(p,{children:[(r==null?void 0:r.image)&&e.jsx(m,{md:2,className:"text-center mb-2",children:e.jsx("img",{src:`${z}/${r.image}`,alt:"User avatar",className:"rounded-circle",style:{width:"60px",height:"60px",objectFit:"cover"},onError:n=>{n.target.style.display="none"}})}),e.jsxs(m,{md:r!=null&&r.image?10:12,children:[e.jsxs("div",{children:[e.jsxs("strong",{children:[t("Name"),":"]})," ",r==null?void 0:r.name]}),e.jsxs("div",{children:[e.jsxs("strong",{children:[t("Email"),":"]})," ",r==null?void 0:r.email]}),(r==null?void 0:r.first_name)&&e.jsxs("div",{children:[e.jsxs("strong",{children:[t("First Name"),":"]})," ",r.first_name]}),(r==null?void 0:r.phone)&&e.jsxs("div",{children:[e.jsxs("strong",{children:[t("Phone"),":"]})," ",r.phone_code?`${r.phone_code} ${r.phone}`:r.phone]}),(r==null?void 0:r.organization)&&e.jsxs("div",{children:[e.jsxs("strong",{children:[t("Organization"),":"]})," ",r.organization]}),e.jsxs("div",{children:[e.jsxs("strong",{children:[t("Status"),":"]}),e.jsx("span",{className:`badge ms-1 ${(r==null?void 0:r.status)===1?"bg-success":"bg-danger"}`,children:(r==null?void 0:r.status)===1?t("Active"):t("Inactive")})]})]})]})})]})})}),e.jsx(p,{className:"mb-4",children:e.jsx(m,{md:12,children:e.jsxs(d.Group,{controlId:"currentPlan",children:[e.jsx(d.Label,{className:"fw-semibold",children:t("Current plan information")}),e.jsx("div",{className:"p-3 bg-light rounded",children:r!=null&&r.current_plan?e.jsxs("div",{className:"d-flex flex-column gap-3",children:[e.jsxs("div",{children:[e.jsxs("strong",{children:[t("Plan"),":"]})," ",r.current_plan.name]}),e.jsxs("div",{children:[e.jsxs("strong",{children:[t("Time"),":"]})," ",r.current_plan.interval," ",t("days")]}),e.jsxs("div",{children:[e.jsxs("strong",{children:[t("Started On"),":"]})," ",r.current_plan.active_on?l(r.current_plan.active_on).format("DD/MM/YYYY HH:mm"):t("N/A")]}),e.jsxs("div",{children:[e.jsxs("strong",{children:[t("Expires On"),":"]}),e.jsxs("span",{className:l(r.current_plan.expires_on).isBefore(l())?"text-danger":"text-success",children:[" ",r.current_plan.expires_on?l(r.current_plan.expires_on).format("DD/MM/YYYY HH:mm"):t("N/A")]})]}),r.current_plan.expires_on&&!l(r.current_plan.expires_on).isBefore(l())&&e.jsxs("div",{children:[e.jsxs("strong",{children:[t("Time remaining"),":"]}),e.jsxs("span",{className:"text-success",children:[" ",(()=>{const n=l(),c=l(r.current_plan.expires_on),a=l.duration(c.diff(n)),o=Math.floor(a.asDays()),i=a.hours(),h=a.minutes(),x=[];return o>0&&x.push(`${o} ${t(`day${o!==1?"s":""}`)}`),i>0&&x.push(`${i.toString().padStart(2,"0")} ${t(`hour${i!==1?"s":""}`)}`),h>0&&x.push(`${h.toString().padStart(2,"0")} ${t(`minute${h!==1?"s":""}`)}`),x.length>0?x.join(" "):`0 ${t("minute")}`})()]})]}),e.jsxs("div",{children:[e.jsxs("strong",{children:[t("Admin add this plan"),":"]}),e.jsx("span",{className:`badge ms-1 ${r.current_plan.admin_set_expires_on==="YES"?"bg-info":"bg-secondary"}`,children:r.current_plan.admin_set_expires_on==="YES"?t("Yes"):t("No")})]}),r.current_plan.description&&e.jsxs("div",{children:[e.jsxs("strong",{children:[t("Description"),":"]})," ",e.jsx("span",{dangerouslySetInnerHTML:{__html:r.current_plan.description}})]})]}):e.jsx("div",{className:"text-muted",children:t("No active plan")})})]})})}),e.jsx(p,{className:"mb-4",children:e.jsx(m,{md:12,children:e.jsxs(d.Group,{controlId:"planId",children:[e.jsxs(d.Label,{children:[t("Select plan"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(G,{value:U,loadOptions:Z,onChange:Q,onBlur:()=>s.setFieldTouched("planId",!0),additional:{page:1},isClearable:!0,clearCacheOnMenuClose:!0,clearCacheOnSearchChange:!0,placeholder:t("Select plan"),classNamePrefix:"select",className:(I=s==null?void 0:s.touched)!=null&&I.planId&&((M=s==null?void 0:s.errors)!=null&&M.planId)?"is-invalid":"",formatOptionLabel:n=>e.jsxs("div",{className:"d-flex justify-content-between align-items-center w-100",children:[e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold",children:n.label}),e.jsx("small",{className:"text-muted",children:n.interval&&e.jsxs("span",{children:[e.jsx("i",{className:"ri-time-line me-1"}),n.interval," ",t("days")]})})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[n.price&&e.jsxs("span",{className:"badge bg-primary-subtle text-primary",children:[new Intl.NumberFormat("vi-VN").format(n.price)," ",t("VND")]}),n.status===0&&e.jsx("span",{className:"badge bg-warning",children:t("Inactive")})]})]}),menuPortalTarget:document.body,styles:{menuPortal:n=>({...n,zIndex:9999})}}),((E=s==null?void 0:s.touched)==null?void 0:E.planId)&&((S=s==null?void 0:s.errors)==null?void 0:S.planId)&&e.jsx("div",{className:"invalid-feedback d-block",children:t(((F=s==null?void 0:s.errors)==null?void 0:F.planId)??"")})]})})}),e.jsx(p,{className:"mb-4",children:e.jsx(m,{md:12,children:e.jsxs(d.Group,{controlId:"datetimeExpired",children:[e.jsxs(d.Label,{children:[t("Time expiration"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(ie,{name:"datetimeExpired",ref:R,className:`form-control ${s.touched.datetimeExpired&&s.errors.datetimeExpired?"is-invalid":""}`,placeholder:t("Select date and time"),options:{enableTime:!0,dateFormat:"Y-m-d H:i",time_24hr:!0,locale:J(),allowInput:!0},value:s.values.datetimeExpired,onChange:n=>{const c=n[0]?l(n[0]).format("YYYY-MM-DD HH:mm"):"";s.setFieldValue("datetimeExpired",c),s.setFieldTouched("datetimeExpired",!0,!1),setTimeout(()=>{s.validateField("datetimeExpired")},0)}}),s.touched.datetimeExpired&&s.errors.datetimeExpired&&e.jsx("div",{className:"invalid-feedback d-block",children:t(s.errors.datetimeExpired??"")})]})})}),e.jsx(p,{className:"mb-4",children:e.jsx(m,{md:12,children:e.jsxs(d.Group,{controlId:"paymentMethodId",children:[e.jsxs(d.Label,{children:[t("Payment method"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(G,{value:X,loadOptions:K,onChange:W,onBlur:()=>s.setFieldTouched("paymentMethodId",!0),additional:{page:1},clearCacheOnMenuClose:!0,clearCacheOnSearchChange:!0,isClearable:!0,placeholder:t("Select payment method"),classNamePrefix:"select",className:(C=s==null?void 0:s.touched)!=null&&C.paymentMethodId&&((w=s==null?void 0:s.errors)!=null&&w.paymentMethodId)?"is-invalid":"",menuPortalTarget:document.body,formatOptionLabel:n=>e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold",children:n.label}),(n.type||n.account_name)&&e.jsxs("small",{className:"text-muted",children:[n.type&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"fw-medium",children:[t("Type"),":"]})," ",n.type]}),n.type&&n.account_name&&" | ",n.account_name&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"fw-medium",children:[t("Account"),"  :"]})," ",n.account_name,n.account_number&&` - ${n.account_number}`]})]})]}),styles:{menuPortal:n=>({...n,zIndex:9999})}}),(($=s==null?void 0:s.touched)==null?void 0:$.paymentMethodId)&&((A=s==null?void 0:s.errors)==null?void 0:A.paymentMethodId)&&e.jsx("div",{className:"invalid-feedback d-block",children:t(((Y=s==null?void 0:s.errors)==null?void 0:Y.paymentMethodId)??"")})]})})}),e.jsx(p,{className:"mb-4",children:e.jsx(m,{md:12,children:e.jsxs(d.Group,{controlId:"amount",children:[e.jsxs(d.Label,{children:[t("Amount"),e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(te,{customInput:d.Control,thousandSeparator:".",decimalSeparator:",",placeholder:t("Enter amount"),decimalScale:2,fixedDecimalScale:!1,allowNegative:!1,isAllowed:n=>{const{floatValue:c}=n;return c===void 0||c<=y},onValueChange:n=>{s.setFieldValue("amount",n.floatValue!==void 0?n.floatValue:"")},onBlur:s.handleBlur,value:s.values.amount,isInvalid:!!(s.touched.amount&&s.errors.amount)}),e.jsx(d.Control.Feedback,{type:"invalid",children:t(((T=s==null?void 0:s.errors)==null?void 0:T.amount)??"")})]})})}),e.jsx(p,{className:"mb-4",children:e.jsx(m,{md:12,children:e.jsxs(d.Group,{controlId:"note",children:[e.jsx(d.Label,{children:t("Note")}),e.jsx(d.Control,{as:"textarea",rows:3,placeholder:t("Enter note"),name:"note",maxLength:500,onChange:s.handleChange,onBlur:s.handleBlur,value:s.values.note,isInvalid:!!((V=s==null?void 0:s.touched)!=null&&V.note&&((B=s==null?void 0:s.errors)!=null&&B.note))}),e.jsx(d.Control.Feedback,{type:"invalid",children:t(((L=s==null?void 0:s.errors)==null?void 0:L.note)??"")})]})})})]})}),e.jsxs(g.Footer,{children:[e.jsx(O,{variant:"light",onClick:()=>{s.resetForm(),v()},children:t("Close")}),e.jsx(O,{variant:"primary",onClick:()=>{s.handleSubmit()},disabled:s.isSubmitting,children:t("Add plan")})]})]})};export{We as ModalAddPlan};
