var be=t=>{throw TypeError(t)};var ee=(t,e,s)=>e.has(t)||be("Cannot "+s);var i=(t,e,s)=>(ee(t,e,"read from private field"),s?s.call(t):e.get(t)),g=(t,e,s)=>e.has(t)?be("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),f=(t,e,s,r)=>(ee(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s),p=(t,e,s)=>(ee(t,e,"access private method"),s);import{d as N,X as ge,j as n}from"./ContextMenuProvider-70dGyTd1.js";import{u as Te,c as _e,a as we}from"./index.esm-C_B50UTS.js";import{S as Ie,p as ye,r as C,s as te,a as V,n as se,i as ie,b as ve,t as Fe,c as K,f as Qe,d as Ue,e as xe,g as Oe,h as ke,u as Be}from"./app-buyer-CGgyul-G.js";import{u as De}from"./useTranslation-DFt4tu8S.js";import{M as X}from"./Modal-BbC9vBkC.js";import{F as _}from"./Form-TBg1Ul28.js";import{C as Re}from"./Card-D7m3nqZ2.js";import{R as Le}from"./Row-BY9l2vf-.js";import{B as Se}from"./Button-B2KYnrk2.js";var v,c,H,y,w,U,E,M,A,k,B,I,F,P,D,h,$,re,ae,ne,oe,ce,le,he,Me,Ne,qe=(Ne=class extends Ie{constructor(e,s){super();g(this,h);g(this,v);g(this,c);g(this,H);g(this,y);g(this,w);g(this,U);g(this,E);g(this,M);g(this,A);g(this,k);g(this,B);g(this,I);g(this,F);g(this,P);g(this,D,new Set);this.options=s,f(this,v,e),f(this,M,null),f(this,E,ye()),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(i(this,c).addObserver(this),Ce(i(this,c),this.options)?p(this,h,$).call(this):this.updateResult(),p(this,h,oe).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ue(i(this,c),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ue(i(this,c),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,p(this,h,ce).call(this),p(this,h,le).call(this),i(this,c).removeObserver(this)}setOptions(e){const s=this.options,r=i(this,c);if(this.options=i(this,v).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof C(this.options.enabled,i(this,c))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");p(this,h,he).call(this),i(this,c).setOptions(this.options),s._defaulted&&!te(this.options,s)&&i(this,v).getQueryCache().notify({type:"observerOptionsUpdated",query:i(this,c),observer:this});const a=this.hasListeners();a&&je(i(this,c),r,this.options,s)&&p(this,h,$).call(this),this.updateResult(),a&&(i(this,c)!==r||C(this.options.enabled,i(this,c))!==C(s.enabled,i(this,c))||V(this.options.staleTime,i(this,c))!==V(s.staleTime,i(this,c)))&&p(this,h,re).call(this);const u=p(this,h,ae).call(this);a&&(i(this,c)!==r||C(this.options.enabled,i(this,c))!==C(s.enabled,i(this,c))||u!==i(this,P))&&p(this,h,ne).call(this,u)}getOptimisticResult(e){const s=i(this,v).getQueryCache().build(i(this,v),e),r=this.createResult(s,e);return Ve(this,r)&&(f(this,y,r),f(this,U,this.options),f(this,w,i(this,c).state)),r}getCurrentResult(){return i(this,y)}trackResult(e,s){return new Proxy(e,{get:(r,a)=>(this.trackProp(a),s==null||s(a),a==="promise"&&!this.options.experimental_prefetchInRender&&i(this,E).status==="pending"&&i(this,E).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(r,a))})}trackProp(e){i(this,D).add(e)}getCurrentQuery(){return i(this,c)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=i(this,v).defaultQueryOptions(e),r=i(this,v).getQueryCache().build(i(this,v),s);return r.fetch().then(()=>this.createResult(r,s))}fetch(e){return p(this,h,$).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),i(this,y)))}createResult(e,s){var me;const r=i(this,c),a=this.options,u=i(this,y),d=i(this,w),S=i(this,U),o=e!==r?e.state:i(this,H),{state:O}=e;let l={...O},T=!1,b;if(s._optimisticResults){const R=this.hasListeners(),W=!R&&Ce(e,s),Q=R&&je(e,r,s,a);(W||Q)&&(l={...l,...Ue(O.data,e.options)}),s._optimisticResults==="isRestoring"&&(l.fetchStatus="idle")}let{error:L,errorUpdatedAt:q,status:x}=l;b=l.data;let z=!1;if(s.placeholderData!==void 0&&b===void 0&&x==="pending"){let R;u!=null&&u.isPlaceholderData&&s.placeholderData===(S==null?void 0:S.placeholderData)?(R=u.data,z=!0):R=typeof s.placeholderData=="function"?s.placeholderData((me=i(this,B))==null?void 0:me.state.data,i(this,B)):s.placeholderData,R!==void 0&&(x="success",b=xe(u==null?void 0:u.data,R,s),T=!0)}if(s.select&&b!==void 0&&!z)if(u&&b===(d==null?void 0:d.data)&&s.select===i(this,A))b=i(this,k);else try{f(this,A,s.select),b=s.select(b),b=xe(u==null?void 0:u.data,b,s),f(this,k,b),f(this,M,null)}catch(R){f(this,M,R)}i(this,M)&&(L=i(this,M),b=i(this,k),q=Date.now(),x="error");const J=l.fetchStatus==="fetching",Y=x==="pending",Z=x==="error",fe=Y&&J,pe=b!==void 0,j={status:x,fetchStatus:l.fetchStatus,isPending:Y,isSuccess:x==="success",isError:Z,isInitialLoading:fe,isLoading:fe,data:b,dataUpdatedAt:l.dataUpdatedAt,error:L,errorUpdatedAt:q,failureCount:l.fetchFailureCount,failureReason:l.fetchFailureReason,errorUpdateCount:l.errorUpdateCount,isFetched:l.dataUpdateCount>0||l.errorUpdateCount>0,isFetchedAfterMount:l.dataUpdateCount>o.dataUpdateCount||l.errorUpdateCount>o.errorUpdateCount,isFetching:J,isRefetching:J&&!Y,isLoadingError:Z&&!pe,isPaused:l.fetchStatus==="paused",isPlaceholderData:T,isRefetchError:Z&&pe,isStale:de(e,s),refetch:this.refetch,promise:i(this,E),isEnabled:C(s.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const R=G=>{j.status==="error"?G.reject(j.error):j.data!==void 0&&G.resolve(j.data)},W=()=>{const G=f(this,E,j.promise=ye());R(G)},Q=i(this,E);switch(Q.status){case"pending":e.queryHash===r.queryHash&&R(Q);break;case"fulfilled":(j.status==="error"||j.data!==Q.value)&&W();break;case"rejected":(j.status!=="error"||j.error!==Q.reason)&&W();break}}return j}updateResult(){const e=i(this,y),s=this.createResult(i(this,c),this.options);if(f(this,w,i(this,c).state),f(this,U,this.options),i(this,w).data!==void 0&&f(this,B,i(this,c)),te(s,e))return;f(this,y,s);const r=()=>{if(!e)return!0;const{notifyOnChangeProps:a}=this.options,u=typeof a=="function"?a():a;if(u==="all"||!u&&!i(this,D).size)return!0;const d=new Set(u??i(this,D));return this.options.throwOnError&&d.add("error"),Object.keys(i(this,y)).some(S=>{const m=S;return i(this,y)[m]!==e[m]&&d.has(m)})};p(this,h,Me).call(this,{listeners:r()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&p(this,h,oe).call(this)}},v=new WeakMap,c=new WeakMap,H=new WeakMap,y=new WeakMap,w=new WeakMap,U=new WeakMap,E=new WeakMap,M=new WeakMap,A=new WeakMap,k=new WeakMap,B=new WeakMap,I=new WeakMap,F=new WeakMap,P=new WeakMap,D=new WeakMap,h=new WeakSet,$=function(e){p(this,h,he).call(this);let s=i(this,c).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(se)),s},re=function(){p(this,h,ce).call(this);const e=V(this.options.staleTime,i(this,c));if(ie||i(this,y).isStale||!ve(e))return;const r=Fe(i(this,y).dataUpdatedAt,e)+1;f(this,I,K.setTimeout(()=>{i(this,y).isStale||this.updateResult()},r))},ae=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(i(this,c)):this.options.refetchInterval)??!1},ne=function(e){p(this,h,le).call(this),f(this,P,e),!(ie||C(this.options.enabled,i(this,c))===!1||!ve(i(this,P))||i(this,P)===0)&&f(this,F,K.setInterval(()=>{(this.options.refetchIntervalInBackground||Qe.isFocused())&&p(this,h,$).call(this)},i(this,P)))},oe=function(){p(this,h,re).call(this),p(this,h,ne).call(this,p(this,h,ae).call(this))},ce=function(){i(this,I)&&(K.clearTimeout(i(this,I)),f(this,I,void 0))},le=function(){i(this,F)&&(K.clearInterval(i(this,F)),f(this,F,void 0))},he=function(){const e=i(this,v).getQueryCache().build(i(this,v),this.options);if(e===i(this,c))return;const s=i(this,c);f(this,c,e),f(this,H,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},Me=function(e){Oe.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(i(this,y))}),i(this,v).getQueryCache().notify({query:i(this,c),type:"observerResultsUpdated"})})},Ne);function $e(t,e){return C(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Ce(t,e){return $e(t,e)||t.state.data!==void 0&&ue(t,e,e.refetchOnMount)}function ue(t,e,s){if(C(e.enabled,t)!==!1&&V(e.staleTime,t)!=="static"){const r=typeof s=="function"?s(t):s;return r==="always"||r!==!1&&de(t,e)}return!1}function je(t,e,s,r){return(t!==e||C(r.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&de(t,s)}function de(t,e){return C(e.enabled,t)!==!1&&t.isStaleByTime(V(e.staleTime,t))}function Ve(t,e){return!te(t.getCurrentResult(),e)}var Pe=N.createContext(!1),He=()=>N.useContext(Pe);Pe.Provider;function Ae(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var ze=N.createContext(Ae()),We=()=>N.useContext(ze),Ge=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},Ke=t=>{N.useEffect(()=>{t.clearReset()},[t])},Xe=({result:t,errorResetBoundary:e,throwOnError:s,query:r,suspense:a})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(a&&t.data===void 0||ke(s,[t.error,r])),Je=t=>{if(t.suspense){const s=a=>a==="static"?a:Math.max(a??1e3,1e3),r=t.staleTime;t.staleTime=typeof r=="function"?(...a)=>s(r(...a)):s(r),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},Ye=(t,e)=>t.isLoading&&t.isFetching&&!e,Ze=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,Ee=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function et(t,e,s){var l,T,b,L,q;const r=He(),a=We(),u=Be(),d=u.defaultQueryOptions(t);(T=(l=u.getDefaultOptions().queries)==null?void 0:l._experimental_beforeQuery)==null||T.call(l,d),d._optimisticResults=r?"isRestoring":"optimistic",Je(d),Ge(d,a),Ke(a);const S=!u.getQueryCache().get(d.queryHash),[m]=N.useState(()=>new e(u,d)),o=m.getOptimisticResult(d),O=!r&&t.subscribed!==!1;if(N.useSyncExternalStore(N.useCallback(x=>{const z=O?m.subscribe(Oe.batchCalls(x)):se;return m.updateResult(),z},[m,O]),()=>m.getCurrentResult(),()=>m.getCurrentResult()),N.useEffect(()=>{m.setOptions(d)},[d,m]),Ze(d,o))throw Ee(d,m,a);if(Xe({result:o,errorResetBoundary:a,throwOnError:d.throwOnError,query:u.getQueryCache().get(d.queryHash),suspense:d.suspense}))throw o.error;if((L=(b=u.getDefaultOptions().queries)==null?void 0:b._experimental_afterQuery)==null||L.call(b,d,o),d.experimental_prefetchInRender&&!ie&&Ye(o,r)){const x=S?Ee(d,m,a):(q=u.getQueryCache().get(d.queryHash))==null?void 0:q.promise;x==null||x.catch(se).finally(()=>{m.updateResult()})}return d.notifyOnChangeProps?o:m.trackResult(o)}function tt(t,e){return et(t,qe)}const st=async t=>{const e=await fetch(`https://coco.mmostore.local/products/detail/${t}`);if(!e.ok)throw new Error("Failed to fetch products");return e.json()},it=({productId:t,show:e,onClose:s})=>{const{t:r}=De(),{data:a,isLoading:u,error:d}=tt({queryKey:["product",t],queryFn:()=>st(t),enabled:!!t&&e}),{errors:S}=ge().props,m=ge().props.storageUrl,o=Te({initialValues:{quantity:0,subProduct:"",price:0},validateOnChange:!0,validateOnBlur:!0,validationSchema:_e({subProduct:we().required(r("Please choose your sub product"))}),onSubmit:l=>{console.log({values:l,productId:t})}}),O=()=>{o.resetForm(),s()};return n.jsxs(X,{show:e,onHide:O,centered:!0,backdrop:"static",size:"lg",children:[n.jsx(X.Header,{closeButton:!0,style:{borderBottom:"none",paddingTop:"2rem",paddingLeft:"2rem",paddingRight:"2rem"},children:n.jsx(X.Title,{style:{fontWeight:"bold",width:"100%",textAlign:"center",fontSize:"1.75rem"},children:"Xác nhận đơn hàng"})}),n.jsxs(X.Body,{style:{padding:"0 2rem 2rem 2rem"},children:[u&&n.jsx("p",{className:"text-center",children:"Đang tải dữ liệu..."}),d&&n.jsx("p",{className:"text-red-500 text-center",children:"Lỗi tải sản phẩm"}),n.jsxs(_,{noValidate:!0,onSubmit:o.handleSubmit,children:[n.jsx(Re,{className:"product",children:n.jsx(Re.Body,{children:n.jsxs(Le,{className:"gy-3",children:[n.jsx("div",{className:"col-sm-auto",children:n.jsx("div",{className:"avatar-xl bg-light rounded p-1",children:n.jsx("img",{src:a&&`${m}/${a.image}`,alt:"",className:"img-fluid d-block"})})}),n.jsxs("div",{className:"col-sm",children:[n.jsx("h5",{className:"",children:a&&a.name}),n.jsx("p",{className:"text-muted mb-2",children:a&&a.short_description}),n.jsxs(_.Group,{children:[n.jsx("div",{className:"d-flex gap-2",children:a==null?void 0:a.sub_products.map(l=>n.jsxs("div",{className:"custom-radio",children:[n.jsx(_.Control,{type:"radio",name:"subProduct",value:String(l.id),className:"form-check-input d-none",id:`sub-${l.id}`,onChange:T=>{o.handleChange(T),o.setFieldValue("quantity",l.quantity??1),o.setFieldValue("price",l.price??1)},onBlur:o.handleBlur,checked:o.values.subProduct===String(l.id)}),n.jsx(_.Label,{htmlFor:`sub-${l.id}`,className:`form-check-label ${o.values.subProduct===String(l.id)?"active":""}`,children:l.name})]},l.id))}),o.touched.subProduct&&o.errors.subProduct&&n.jsx("div",{className:"text-danger small",children:o.errors.subProduct})]}),n.jsxs("div",{className:"input-step mb-3",children:[n.jsx("button",{type:"button",className:"minus material-shadow",disabled:!o.values.subProduct,onClick:()=>o.setFieldValue("quantity",Math.max(1,Number(o.values.quantity)-1)),children:"–"}),n.jsxs(_.Group,{children:[n.jsx(_.Control,{type:"text",className:"text-center",name:"quantity",value:o.values.quantity,onChange:o.handleChange,disabled:!o.values.subProduct,min:1}),n.jsx(_.Control.Feedback,{type:"invalid",children:o.errors.quantity||(S==null?void 0:S.quantity)})]}),n.jsx("button",{type:"button",disabled:!o.values.subProduct,className:"plus material-shadow",onClick:()=>o.setFieldValue("quantity",Number(o.values.quantity)+1),children:"+"})]}),n.jsxs("div",{className:"d-flex align-items-center",children:[n.jsx("p",{className:"text-muted mb-0 me-2",children:"Price:"}),n.jsxs("span",{className:"fs-18 text-danger",children:["$",n.jsx("span",{id:"ticket_price",className:"product-price",children:o.values.price*o.values.quantity})]})]}),n.jsx("div",{className:"col-sm-auto"})]})]})})}),n.jsxs("div",{className:"d-flex gap-2 justify-content-end",children:[n.jsx(Se,{variant:"light",type:"button",style:{fontWeight:"bold"},onClick:O,children:"Close"}),n.jsx(Se,{variant:"success",type:"submit",style:{fontWeight:"bold"},children:"Buy"})]})]})]})]})},mt=Object.freeze(Object.defineProperty({__proto__:null,default:it},Symbol.toStringTag,{value:"Module"}));export{it as M,mt as a,tt as u};
