import{X as A,A as M,d as b,j as s}from"./ContextMenuProvider-DoI9LuTu.js";import{u as B,c as v,e as _,g as E}from"./index.esm-yjK6ua4W.js";import{S as L}from"./react-select.esm-Ci0lS3LH.js";import{s as R}from"./showToast-BFjkHmvN.js";import{u as T}from"./useTranslation-Bh5zzBC_.js";import{F as j}from"./Form-C6Oq7frR.js";import{M as h}from"./Modal-Ct9dsq7D.js";import{B as w}from"./Button-CdshqBqI.js";import"./isSymbol-CYvIzdD2.js";import"./hoist-non-react-statics.cjs-BsRiVy2U.js";import"./objectWithoutPropertiesLoose-Dsqj8S3w.js";import"./extends-CF3RwP-h.js";import"./setPrototypeOf-DgZC2w_0.js";import"./inherits-B2gPeQio.js";import"./react-toastify.esm-8BWsAHON.js";import"./ThemeProvider-CQKb4rSK.js";import"./index-B7rcZTdA.js";import"./Col-BERnSmBs.js";import"./useMergedRefs-Cm3LQ1VB.js";import"./useEventCallback-BA23UYAQ.js";import"./useWillUnmount-CWisbIWq.js";import"./TransitionWrapper-CRtjL7Sb.js";import"./AbstractModalHeader-Baf6fi1-.js";import"./useWindow-B3mPSubg.js";import"./querySelectorAll-rMMgkU1T.js";import"./useEventCallback-Bsoi2xyD.js";import"./hasClass-B9uJik72.js";import"./NoopTransition-Badst7zB.js";import"./DataKey-DjdvojM5.js";import"./CloseButton-feMrj_cP.js";import"./Fade-iG7JUvQW.js";import"./divWithClassName-Ct-4CK0x.js";import"./Button-lElTeqs9.js";const xs=({show:x,onHide:u,dataVerifyStore:e,storeCategoryOptions:d,onReloadOptions:f})=>{var N;const{t:l}=T(),g=A().props.errors,i=B({initialValues:{stores:[]},validationSchema:v({stores:_().min(1,l("Please verify at least one store")).of(v({store_id:E().required(),store_category_ids:_()}))}),onSubmit:r=>{const m=route("admin.user.verify-store"),c={stores:r.stores};M.post(m,c,{replace:!0,preserveScroll:!0,preserveState:!0,onSuccess:n=>{var t,a;(a=(t=n.props)==null?void 0:t.message)!=null&&a.success&&(i.resetForm(),u())},onError:n=>{R(l("An error occurred while saving verification information"),"error")}})}}),k=r=>{const m=i.values.stores.find(c=>c.store_id===r);return(d==null?void 0:d.filter(c=>m==null?void 0:m.store_category_ids.includes(c==null?void 0:c.value)))||[]},F=(r,m)=>{const c=[...i.values.stores],n=c.findIndex(t=>t.store_id===r);n>=0?c[n].store_category_ids=m:c.push({store_id:r,store_category_ids:m}),i.setFieldValue("stores",c)};return b.useEffect(()=>{var r;if(x){const m=((r=e==null?void 0:e.stores)==null?void 0:r.map(c=>{var n;return{store_id:c.id,store_category_ids:((n=c.store_categories)==null?void 0:n.map(t=>t.id))||[]}}))||[];i.setValues({stores:m})}else i.resetForm()},[x,e]),b.useEffect(()=>{i.setErrors(g||{})},[g]),s.jsx(j,{onSubmit:i.handleSubmit,noValidate:!0,children:s.jsxs(h,{id:"myModal",backdrop:"static",show:x,onHide:()=>{i.resetForm(),u()},centered:!0,scrollable:!0,children:[s.jsx(h.Header,{closeButton:!0,children:s.jsx("h5",{children:l("Verify store")})}),s.jsxs(h.Body,{children:[i.touched.stores&&i.errors.stores&&typeof i.errors.stores=="string"&&s.jsx("div",{className:"alert alert-danger mb-3",children:l(i.errors.stores)}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"bg-light rounded p-3 mb-5",children:[s.jsxs("div",{className:"row align-items-center mb-2",children:[s.jsx("div",{className:"col-lg-4",children:s.jsxs("span",{className:"fw-semibold",children:[l("Name user"),":"]})}),s.jsx("div",{className:"col-lg-8",children:s.jsx("span",{className:"text-dark",children:(e==null?void 0:e.name)||"-"})})]}),s.jsxs("div",{className:"row align-items-center",children:[s.jsx("div",{className:"col-lg-4",children:s.jsx("span",{className:"fw-semibold",children:"Email:"})}),s.jsx("div",{className:"col-lg-8",children:s.jsx("span",{className:"text-dark",children:(e==null?void 0:e.email)||"-"})})]})]}),!!(e!=null&&e.stores)&&(e==null?void 0:e.stores.length)>0&&s.jsxs("div",{className:"stores-container",children:[s.jsxs("h6",{className:"fw-semibold mb-3",children:[l("Registered stores"),":"]}),(N=e==null?void 0:e.stores)==null?void 0:N.map((r,m)=>{const c=`stores.${m}.store_category_ids`,n=i.errors.stores&&Array.isArray(i.errors.stores)&&i.errors.stores[m],t=i.touched.stores&&Array.isArray(i.touched.stores)&&i.touched.stores[m],a=!!r.verified_at;return s.jsxs("div",{className:"store-card border rounded mb-4 p-3 bg-white",children:[s.jsx("div",{className:"d-flex align-items-center justify-content-between mb-3",children:s.jsxs("h6",{className:"mb-0 ",children:[s.jsx("i",{className:"ri-store-2-line me-2"}),!!(r!=null&&r.name)&&s.jsxs(s.Fragment,{children:[l("Store"),": ",s.jsx("span",{className:"fw-bold fst-italic",children:r.name})]}),s.jsx("span",{className:`ms-3 badge border ${a?"border-success text-success":"border-danger text-danger"} bg-white`,children:l(a?"Verified":"Not verified")})]})}),s.jsxs(j.Group,{className:"mb-3",controlId:`store_category_ids_${r.id}`,children:[s.jsxs(j.Label,{children:[s.jsxs("span",{className:"fw-bold",children:[l("Store category"),":"]})," ",s.jsx("small",{className:"fst-italic text-muted",children:"(Bỏ trống để huỷ xác minh)"})]}),s.jsx(L,{isMulti:!0,options:d,placeholder:l("Select store categories"),onMenuOpen:f,value:k(r.id),onChange:o=>{const p=o?o.map($=>$.value):[];F(r.id,p)},onBlur:()=>i.setFieldTouched(c,!0),className:t!=null&&t.store_category_ids&&(n!=null&&n.store_category_ids)?"is-invalid":""}),(t==null?void 0:t.store_category_ids)&&(n==null?void 0:n.store_category_ids)&&s.jsx("div",{className:"invalid-feedback d-block",children:l(n.store_category_ids??"")})]}),r!=null&&r.domain&&r.domain.length>0?s.jsxs("div",{className:"domains-grid",children:[s.jsx("div",{className:"mb-2 d-flex align-items-center justify-content-between",children:s.jsx("span",{className:"fw-bold",children:"Link domain:"})}),s.jsx("div",{className:"row g-2",children:r.domain.map((o,p)=>s.jsx("div",{className:"col-12 col-md-12",children:s.jsx("div",{className:"domain-item bg-light rounded p-2 h-100",children:s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx("i",{className:"fas fa-globe text-muted me-2"}),s.jsx("a",{href:`https://${o}`,target:"_blank",rel:"noopener noreferrer",className:"text-decoration-none text-primary fw-medium flex-grow-1",title:`${l("Visit")} ${o}`,children:!!o&&`https://${o}`}),s.jsx("i",{className:"fas fa-external-link-alt text-muted ms-2",style:{fontSize:"0.75rem"}})]})})},`${r.id}-${p}`))})]}):s.jsxs("div",{className:"text-center py-3 text-muted",children:[s.jsx("i",{className:"fas fa-exclamation-circle me-2"}),l("No domains registered for this store")]})]},m)})]}),(!(e!=null&&e.stores)||(e==null?void 0:e.stores.length)===0)&&s.jsxs("div",{className:"text-center py-4 text-muted",children:[s.jsx("i",{className:"fas fa-store-slash fs-1 mb-3 d-block"}),s.jsx("h6",{children:l("No stores found")}),s.jsx("p",{className:"mb-0",children:l("This user has not registered any stores yet.")})]})]})]}),s.jsxs(h.Footer,{children:[s.jsx(w,{variant:"light",onClick:()=>{i.resetForm(),u()},children:l("Cancel")}),s.jsx(w,{variant:"secondary",disabled:!(e!=null&&e.stores)||(e==null?void 0:e.stores.length)===0,onClick:()=>{i.submitForm()},children:l("Save verify information")})]})]})})};export{xs as ModalVerifyStore};
