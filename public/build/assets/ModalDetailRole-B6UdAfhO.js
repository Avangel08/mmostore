import{X as $,A as L,d as I,j as r}from"./index-DHodSrNF.js";import{u as M,c as V,d as _,a as C,e as R}from"./index.esm-ahYUvUjO.js";import{B as w,F as A}from"./react-toastify.esm-Be9yEAaS.js";import{u as O}from"./useTranslation-D2OX4grP.js";import{M as x}from"./Modal-auM1MqMs.js";import{F as a}from"./Form-C94ppvWt.js";import{C as q}from"./Container-DRymHc_Z.js";import{R as D}from"./Row-GpXL3wqf.js";import{C as F}from"./Col-D9XJnvlI.js";import{B as k}from"./Button-jo9UmU5v.js";import"./isSymbol-Bhs3vyb9.js";import"./hoist-non-react-statics.cjs-DQogQWOa.js";import"./ThemeProvider-DmPqGCJU.js";import"./TransitionWrapper-C6k9yB4y.js";import"./setPrototypeOf-B4fUID9J.js";import"./index-B-_R4KmE.js";import"./useEventCallback-CK1kDXa6.js";import"./AbstractModalHeader-DgYM_Ft_.js";import"./DataKey-BiDULxbQ.js";import"./CloseButton-Yvwnd2jn.js";import"./Button-CNHxlnfg.js";const te=({show:g,onHide:f,dataEdit:n})=>{var v;const{t:l}=O(),{guards:j,allGroupPermissions:d}=$().props,t=!!n,b=(e,i)=>{w[i](e,{position:"top-center",autoClose:2500,hideProgressBar:!1,closeOnClick:!1,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored",transition:A})},s=M({initialValues:{roleName:(n==null?void 0:n.name)||"",guard:(n==null?void 0:n.guard_name)||"",permissionIds:((v=n==null?void 0:n.group_permissions)==null?void 0:v.flatMap(e=>e.permissions.map(i=>i.id)))||[]},validationSchema:V({roleName:C().max(50,"Must be 50 characters or less").required(l("Please enter this field")),guard:C().required(l("Please select guard")),permissionIds:_().of(R())}),onSubmit:e=>{const i=t?route("admin.roles.update",{id:n.id}):route("admin.roles.add"),o=t?"put":"post",m=e.permissionIds.filter(c=>{for(const u of d||[]){const p=u.permissions.find(h=>h.id===c);if(p&&p.guard_name===e.guard)return!0}return!1}),P={...e,permissionIds:m};L[o](i,P,{onSuccess:c=>{var u,p,h,N;if((p=(u=c.props)==null?void 0:u.message)!=null&&p.error){b(l(c.props.message.error),"error");return}s.resetForm(),f(),(N=(h=c.props)==null?void 0:h.message)!=null&&N.success&&b(l(c.props.message.success),"success")},onError:c=>{const u=Object.values(c).join(", ");b(u,"error")}})}}),y=(e,i)=>{let o=[...s.values.permissionIds];i?o.push(e):o=o.filter(m=>m!==e),s.setFieldValue("permissionIds",o)},S=(e,i)=>{let o=[...s.values.permissionIds];i?e.forEach(m=>{o.includes(m)||o.push(m)}):o=o.filter(m=>!e.includes(m)),s.setFieldValue("permissionIds",o)},B=e=>e.every(i=>s.values.permissionIds.includes(i)),G=()=>d?s.values.guard?d.map(e=>({...e,permissions:e.permissions.filter(i=>i.guard_name===s.values.guard)})).filter(e=>e.permissions.length>0):d:[];return I.useEffect(()=>{t||s.setFieldValue("permissionIds",[])},[s.values.guard,t]),I.useEffect(()=>{var e;g?s.setValues({roleName:(n==null?void 0:n.name)||"",guard:(n==null?void 0:n.guard_name)||"",permissionIds:((e=n==null?void 0:n.group_permissions)==null?void 0:e.flatMap(i=>i.permissions.map(o=>o.id)))||[]}):s.resetForm()},[g,n]),r.jsx(x,{id:"myModal",backdrop:"static",show:g,onHide:()=>{s.resetForm(),f()},centered:!0,children:r.jsxs(a,{onSubmit:s.handleSubmit,noValidate:!0,children:[r.jsx(x.Header,{closeButton:!0,children:r.jsx("h5",{children:l(t?"Edit role":"Add role")})}),r.jsxs(x.Body,{children:[r.jsxs(a.Group,{className:"mb-3",controlId:"roleName",children:[r.jsxs(a.Label,{children:[l("Role name"),r.jsx("span",{className:"text-danger",children:"*"})]}),r.jsx(a.Control,{type:"text",placeholder:l("Enter role name"),maxLength:50,onChange:s.handleChange,onBlur:s.handleBlur,value:s.values.roleName,isInvalid:!!(s.touched.roleName&&s.errors.roleName)}),r.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.roleName})]}),r.jsxs(a.Group,{className:"mb-3",controlId:"guard",children:[r.jsxs(a.Label,{children:[l("Guard")," ",r.jsx("span",{className:"text-danger",children:"*"})]}),r.jsxs(a.Select,{onChange:s.handleChange,onBlur:s.handleBlur,value:s.values.guard,isInvalid:!!(s.touched.guard&&s.errors.guard),children:[r.jsx("option",{value:"",children:l("Select guard")}),j==null?void 0:j.map(e=>r.jsx("option",{value:e.value,children:e.label},e.value))]}),r.jsx(a.Control.Feedback,{type:"invalid",children:s.errors.guard})]}),s.values.guard&&r.jsxs(a.Group,{className:"mb-3",controlId:"permissionIds",children:[r.jsx(a.Label,{children:l("Group permission")}),r.jsxs(q,{className:"border rounded p-3 bg-light",children:[G().map((e,i)=>r.jsxs("div",{className:"mb-3",children:[r.jsx("div",{className:"fw-bold mb-2 text-primary",children:e.name}),r.jsxs(D,{children:[r.jsx(F,{xs:12,className:"mb-2",children:r.jsx(a.Check,{type:"checkbox",id:`group-${e.id}-all`,label:`${l("Select all")} ${e.name}`,checked:B(e.permissions.map(o=>o.id)),onChange:o=>{S(e.permissions.map(m=>m.id),o.target.checked)},className:"fw-semibold text-secondary"})}),e.permissions.map(o=>r.jsx(F,{xs:12,md:6,className:"mb-2",children:r.jsx(a.Check,{type:"checkbox",id:`permission-${o.id}`,label:o.name,checked:s.values.permissionIds.includes(o.id),onChange:m=>{y(o.id,m.target.checked)},className:"ms-3"})},o.id))]})]},e.id)),s.touched.permissionIds&&s.errors.permissionIds&&r.jsx("div",{className:"text-danger",style:{fontSize:"0.875em"},children:s.errors.permissionIds})]})]})]}),r.jsxs(x.Footer,{children:[r.jsx(k,{variant:"light",onClick:()=>{s.resetForm(),f()},children:l("Close")}),r.jsx(k,{variant:"primary",type:"submit",children:l(t?"Update role":"Save changes")})]})]})})};export{te as ModalDetailRole};
