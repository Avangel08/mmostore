import{X as L,A as M,d as I,j as r}from"./ContextMenuProvider-DCdb8j9t.js";import{u as P,c as V,d as _,a as C,f as R}from"./index.esm-CC-SwQOh.js";import{s as b}from"./showToast-5wcdUU64.js";import{u as w}from"./useTranslation-BeBCG-tb.js";import{M as x}from"./Modal-PiC5wIE_.js";import{F as m}from"./Form-BwWb-AQG.js";import{C as A}from"./Container-B-XzGzbE.js";import{R as q}from"./Row-DcrQzJSf.js";import{C as F}from"./Col-BKpEL2i4.js";import{B as k}from"./Button-DkR4lkD4.js";import"./isSymbol-CYvIzdD2.js";import"./hoist-non-react-statics.cjs-Cl0fTsAK.js";import"./react-toastify.esm-Bwsw1aoB.js";import"./ThemeProvider-B2_W_dCu.js";import"./useMergedRefs-qO3RddUr.js";import"./useEventCallback-Blih2yEw.js";import"./useWillUnmount-ClVsaD3q.js";import"./TransitionWrapper-WlnnEX3_.js";import"./objectWithoutPropertiesLoose-Dsqj8S3w.js";import"./setPrototypeOf-DgZC2w_0.js";import"./AbstractModalHeader-BzQN1u3g.js";import"./useWindow-XMw1SZRE.js";import"./querySelectorAll-BUF6GxAr.js";import"./useEventCallback-B3WkzC8o.js";import"./hasClass-CFrhebZ5.js";import"./NoopTransition-DV-WmqrX.js";import"./DataKey-DjdvojM5.js";import"./CloseButton-DmCN2KAW.js";import"./index-BSRKPwsw.js";import"./Fade-_gEJg8B2.js";import"./divWithClassName-CMPxMdR0.js";import"./Button-DW89RreQ.js";const be=({show:f,onHide:g,dataEdit:i})=>{var v;const{t:n}=w(),{guards:j,allGroupPermissions:d}=L().props,c=!!i,s=P({initialValues:{roleName:(i==null?void 0:i.name)||"",guard:(i==null?void 0:i.guard_name)||"",permissionIds:((v=i==null?void 0:i.group_permissions)==null?void 0:v.flatMap(e=>e.permissions.map(l=>l.id)))||[]},validationSchema:V({roleName:C().max(50,"Must be 50 characters or less").required(n("Please enter this field")),guard:C().required(n("Please select guard")),permissionIds:_().of(R())}),onSubmit:e=>{const l=c?route("admin.roles.update",{id:i.id}):route("admin.roles.add"),o=c?"put":"post",a=e.permissionIds.filter(t=>{for(const p of d||[]){const u=p.permissions.find(h=>h.id===t);if(u&&u.guard_name===e.guard)return!0}return!1}),B={...e,permissionIds:a};M[o](l,B,{onSuccess:t=>{var p,u,h,N;if((u=(p=t.props)==null?void 0:p.message)!=null&&u.error){b(n(t.props.message.error),"error");return}s.resetForm(),g(),(N=(h=t.props)==null?void 0:h.message)!=null&&N.success&&b(n(t.props.message.success),"success")},onError:t=>{const p=Object.values(t).join(", ");b(p,"error")}})}}),y=(e,l)=>{let o=[...s.values.permissionIds];l?o.push(e):o=o.filter(a=>a!==e),s.setFieldValue("permissionIds",o)},S=(e,l)=>{let o=[...s.values.permissionIds];l?e.forEach(a=>{o.includes(a)||o.push(a)}):o=o.filter(a=>!e.includes(a)),s.setFieldValue("permissionIds",o)},G=e=>e.every(l=>s.values.permissionIds.includes(l)),$=()=>d?s.values.guard?d.map(e=>({...e,permissions:e.permissions.filter(l=>l.guard_name===s.values.guard)})).filter(e=>e.permissions.length>0):d:[];return I.useEffect(()=>{c||s.setFieldValue("permissionIds",[])},[s.values.guard,c]),I.useEffect(()=>{var e;f?s.setValues({roleName:(i==null?void 0:i.name)||"",guard:(i==null?void 0:i.guard_name)||"",permissionIds:((e=i==null?void 0:i.group_permissions)==null?void 0:e.flatMap(l=>l.permissions.map(o=>o.id)))||[]}):s.resetForm()},[f,i]),r.jsx(x,{id:"myModal",backdrop:"static",show:f,onHide:()=>{s.resetForm(),g()},centered:!0,children:r.jsxs(m,{onSubmit:s.handleSubmit,noValidate:!0,children:[r.jsx(x.Header,{closeButton:!0,children:r.jsx("h5",{children:n(c?"Edit role":"Add role")})}),r.jsxs(x.Body,{children:[r.jsxs(m.Group,{className:"mb-3",controlId:"roleName",children:[r.jsxs(m.Label,{children:[n("Role name"),r.jsx("span",{className:"text-danger",children:"*"})]}),r.jsx(m.Control,{type:"text",placeholder:n("Enter role name"),maxLength:50,onChange:s.handleChange,onBlur:s.handleBlur,value:s.values.roleName,isInvalid:!!(s.touched.roleName&&s.errors.roleName)}),r.jsx(m.Control.Feedback,{type:"invalid",children:s.errors.roleName})]}),r.jsxs(m.Group,{className:"mb-3",controlId:"guard",children:[r.jsxs(m.Label,{children:[n("Guard")," ",r.jsx("span",{className:"text-danger",children:"*"})]}),r.jsxs(m.Select,{onChange:s.handleChange,onBlur:s.handleBlur,value:s.values.guard,isInvalid:!!(s.touched.guard&&s.errors.guard),children:[r.jsx("option",{value:"",children:n("Select guard")}),j==null?void 0:j.map(e=>r.jsx("option",{value:e.value,children:e.label},e.value))]}),r.jsx(m.Control.Feedback,{type:"invalid",children:s.errors.guard})]}),s.values.guard&&r.jsxs(m.Group,{className:"mb-3",controlId:"permissionIds",children:[r.jsx(m.Label,{children:n("Group permission")}),r.jsxs(A,{className:"border rounded p-3 bg-light",children:[$().map((e,l)=>r.jsxs("div",{className:"mb-3",children:[r.jsx("div",{className:"fw-bold mb-2 text-primary",children:e.name}),r.jsxs(q,{children:[r.jsx(F,{xs:12,className:"mb-2",children:r.jsx(m.Check,{type:"checkbox",id:`group-${e.id}-all`,label:`${n("Select all")} ${e.name}`,checked:G(e.permissions.map(o=>o.id)),onChange:o=>{S(e.permissions.map(a=>a.id),o.target.checked)},className:"fw-semibold text-secondary"})}),e.permissions.map(o=>r.jsx(F,{xs:12,md:6,className:"mb-2",children:r.jsx(m.Check,{type:"checkbox",id:`permission-${o.id}`,label:o.name,checked:s.values.permissionIds.includes(o.id),onChange:a=>{y(o.id,a.target.checked)},className:"ms-3"})},o.id))]})]},e.id)),s.touched.permissionIds&&s.errors.permissionIds&&r.jsx("div",{className:"text-danger",style:{fontSize:"0.875em"},children:s.errors.permissionIds})]})]})]}),r.jsxs(x.Footer,{children:[r.jsx(k,{variant:"light",onClick:()=>{s.resetForm(),g()},children:n("Close")}),r.jsx(k,{variant:"primary",type:"submit",children:n(c?"Update role":"Save changes")})]})]})})};export{be as ModalDetailRole};
