import{R as p,X as E,A as I,j as r}from"./ContextMenuProvider-BhVN3MI2.js";import{u as $,c as K,d as R,a}from"./index.esm-C_ZlIYoE.js";import{s as j}from"./showToast-BKDwzp8a.js";import{u as w}from"./useTranslation-ZbZFIHja.js";import{M as h}from"./Modal-C594Uytt.js";import{F as i}from"./Form-B_1_SP-R.js";import{C as A}from"./Container-DaelVuOS.js";import{R as L}from"./Row-DTCryV-T.js";import{C as F}from"./Col-CDTbDU3W.js";import{B as k}from"./Button-CT1W-dlW.js";import"./isSymbol-CYvIzdD2.js";import"./hoist-non-react-statics.cjs-3lIPCjJv.js";import"./react-toastify.esm-Bzp-JuTX.js";import"./ThemeProvider-CUiVOj3n.js";import"./useMergedRefs-BdX62CzH.js";import"./useEventCallback-DN7Xb1FR.js";import"./useWillUnmount-RaeYL0I0.js";import"./TransitionWrapper-CHWC6Aev.js";import"./objectWithoutPropertiesLoose-Dsqj8S3w.js";import"./setPrototypeOf-DgZC2w_0.js";import"./AbstractModalHeader-ONgXPvo5.js";import"./useWindow-D06ww4p5.js";import"./querySelectorAll-BZjzdW4C.js";import"./useEventCallback-kYw4fXYA.js";import"./hasClass-Du0ceSUq.js";import"./NoopTransition-Ba3l4ZU6.js";import"./DataKey-DjdvojM5.js";import"./CloseButton-D0xq5bFg.js";import"./index-CMi1q9xw.js";import"./Fade-DZUndS-E.js";import"./divWithClassName-DOGM4Upq.js";import"./Button-ItoOpMhW.js";const be=({show:G,onHide:g,data:e})=>{var v,N,y;const{t:l}=w(),x=p.useRef(null),{guards:d}=E().props,b=(o,n)=>o.replace(`${n}_`,""),[P,f]=p.useState([]),c=p.useRef(null);p.useEffect(()=>{if(e!=null&&e.permissions&&(e!=null&&e.key)){const o=e.permissions.map(n=>b(n==null?void 0:n.name,e==null?void 0:e.key));f(o)}},[e]);const s=$({initialValues:{groupPermissionName:(e==null?void 0:e.name)||"",groupPermissionDescription:(e==null?void 0:e.description)||"",groupPermissionKey:(e==null?void 0:e.key)||"",groupPermissionGuard:((N=(v=e==null?void 0:e.permissions)==null?void 0:v[0])==null?void 0:N.guard_name)||"",groupPermissionValue:e!=null&&e.permissions&&(e!=null&&e.key)?e.permissions.map(o=>b(o==null?void 0:o.name,e==null?void 0:e.key)):[]},enableReinitialize:!0,validationSchema:K({groupPermissionName:a().max(50,"Must be 50 characters or less").required(l("Please enter this field")),groupPermissionDescription:a().max(1e3,"Must be 1000 characters or less"),groupPermissionGuard:a().required(l("Please select guard")),groupPermissionValue:R().min(1,"Please select at least one permission").of(a().max(50,"Must be 50 characters or less"))}),onSubmit:o=>{const n={id:e==null?void 0:e.id,groupPermissionName:o.groupPermissionName,groupPermissionDescription:o.groupPermissionDescription,groupPermissionKey:e==null?void 0:e.key,groupPermissionGuard:o.groupPermissionGuard,groupPermissionValue:o.groupPermissionValue};I.put(route("admin.permissions.update",e==null?void 0:e.id),n,{onSuccess:m=>{var u,t,C,V;if((t=(u=m.props)==null?void 0:u.message)!=null&&t.error){j(l(m.props.message.error),"error");return}s.resetForm(),g(),(V=(C=m.props)==null?void 0:C.message)!=null&&V.success&&j(l(m.props.message.success),"success")},onError:m=>{const u=Object.values(m).join(", ");j(u,"error")}})}});p.useEffect(()=>{e!=null&&e.key&&x.current&&x.current.classList.remove("d-none")},[e]);const B=()=>{document.getElementById("checkAll").checked?s.setFieldValue("groupPermissionValue",P.concat("all")):s.setFieldValue("groupPermissionValue",[])},D=o=>{const n=o.target.value,m=o.target.checked;let u=[...s.values.groupPermissionValue];m?u.push(n):u=u.filter(t=>t!==n),s.setFieldValue("groupPermissionValue",u)},S=()=>{var o;if((o=c==null?void 0:c.current)!=null&&o.value){const n=c.current.value;f(u=>u.includes(n)?u:[...u,n]);const m=[...s.values.groupPermissionValue];m.includes(n)||(m.push(n),s.setFieldValue("groupPermissionValue",m)),c.current.value=""}};return r.jsx(h,{id:"myModal",backdrop:"static",show:G,onHide:()=>{s.resetForm(),g()},centered:!0,children:r.jsxs(i,{onSubmit:s.handleSubmit,noValidate:!0,children:[r.jsx(h.Header,{closeButton:!0,children:r.jsx("h5",{children:l("Edit group permission")})}),r.jsxs(h.Body,{children:[r.jsxs(i.Group,{className:"mb-3",controlId:"groupPermissionName",children:[r.jsxs(i.Label,{children:[l("Group permission name")," ",r.jsx("span",{className:"text-danger",children:"*"})]}),r.jsx(i.Control,{type:"text",placeholder:l("Enter group permission name"),maxLength:50,onChange:s.handleChange,onBlur:s.handleBlur,value:s.values.groupPermissionName,isInvalid:!!(s.touched.groupPermissionName&&s.errors.groupPermissionName)}),r.jsx(i.Control.Feedback,{type:"invalid",children:s.errors.groupPermissionName})]}),r.jsxs(i.Group,{className:"mb-3",controlId:"groupPermissionGuard",children:[r.jsxs(i.Label,{children:[l("Guard")," ",r.jsx("span",{className:"text-danger",children:"*"})]}),r.jsxs(i.Select,{onChange:s.handleChange,onBlur:s.handleBlur,value:s.values.groupPermissionGuard,isInvalid:!!(s.touched.groupPermissionGuard&&s.errors.groupPermissionGuard),children:[r.jsx("option",{value:"",children:l("Select guard")}),d==null?void 0:d.map(o=>r.jsx("option",{value:o.value,children:o.label},o.value))]}),r.jsx(i.Control.Feedback,{type:"invalid",children:s.errors.groupPermissionGuard})]}),r.jsxs(i.Group,{className:"mb-3",controlId:"groupPermissionDescription",children:[r.jsx(i.Label,{children:l("Description")}),r.jsx(i.Control,{as:"textarea",rows:6,maxLength:1e3,placeholder:l("Enter description"),onChange:s.handleChange,onBlur:s.handleBlur,value:s.values.groupPermissionDescription,isInvalid:!!(s.touched.groupPermissionDescription&&s.errors.groupPermissionDescription)}),r.jsx(i.Control.Feedback,{type:"invalid",children:s.errors.groupPermissionDescription})]}),r.jsxs(i.Group,{className:"mb-3",controlId:"groupPermissionKey",children:[r.jsxs(i.Label,{children:["Key ",r.jsx("span",{className:"text-danger",children:"*"})]}),r.jsx(i.Control,{type:"text",placeholder:l("Enter key"),maxLength:50,onBlur:s.handleBlur,value:s.values.groupPermissionKey,disabled:!0,isInvalid:!!(s.touched.groupPermissionKey&&s.errors.groupPermissionKey)}),r.jsx(i.Control.Feedback,{type:"invalid",children:s.errors.groupPermissionKey})]}),r.jsxs(i.Group,{ref:x,id:"permissionCheckbox",className:"mb-3",controlId:"groupPermissionValue",children:[r.jsxs(i.Label,{htmlFor:"",children:[l("Permissions")," ",r.jsx("span",{className:"text-danger",children:"*"})]}),r.jsxs(A,{children:[r.jsxs(L,{children:[P.length>0&&r.jsx(F,{xs:12,className:"mb-2",children:r.jsx(i.Check,{id:"checkAll",type:"checkbox",value:"all",label:l("Select all"),onChange:o=>{B()},onBlur:s.handleBlur,checked:(y=s.values.groupPermissionValue)==null?void 0:y.includes("all")})}),P.map(o=>{var n;return r.jsx(F,{xs:12,lg:6,className:"mb-2",children:r.jsx(i.Check,{type:"checkbox",id:`form-check-${o}`,value:o,label:`${e==null?void 0:e.key}_${o}`,onChange:m=>{D(m)},onBlur:s.handleBlur,checked:(n=s.values.groupPermissionValue)==null?void 0:n.includes(o)},o)})})]}),r.jsx(L,{children:s.touched.groupPermissionValue&&s.errors.groupPermissionValue&&r.jsx("div",{className:"text-danger",style:{fontSize:"0.875em"},children:s.errors.groupPermissionValue})}),r.jsxs(i.Group,{className:"d-flex flex-row gap-2 mt-3",children:[r.jsx(i.Control,{placeholder:l("Input permission name"),maxLength:50,ref:c,onChange:o=>{const n=o.target.value.replace(/[^A-Za-z-.0-9]/g,"");o.target.value=n}}),r.jsx(k,{size:"sm",variant:"primary",onClick:S,children:l("Add")})]})]})]})]}),r.jsxs(h.Footer,{children:[r.jsx(k,{variant:"light",onClick:()=>{s.resetForm(),g()},children:l("Close")}),r.jsx(k,{variant:"primary",type:"submit",children:l("Update")})]})]})})};export{be as ModalEditGroupPermission};
